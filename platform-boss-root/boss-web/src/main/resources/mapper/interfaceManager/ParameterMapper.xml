<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.boss.platform.dao.interfaceManager.ParameterMapper">
  <resultMap id="BaseResultMap" type="cn.boss.platform.bean.interfaceManager.ParameterBean">
    <id column="id" jdbcType="INTEGER" property="id"/>
    <result column="project_id" jdbcType="INTEGER" property="projectId"/>
    <result column="group_id" jdbcType="INTEGER" property="groupId"/>
    <result column="interface_id" jdbcType="INTEGER" property="interfaceId"/>
    <result column="env_id" jdbcType="INTEGER" property="envId"/>
    <result column="name" jdbcType="VARCHAR" property="name"/>
    <result column="value" jdbcType="VARCHAR" property="value"/>
    <result column="type" jdbcType="VARCHAR" property="type"/>
    <result column="global" jdbcType="VARCHAR" property="global"/>
    <result column="case_id" jdbcType="INTEGER" property="caseId"/>
    <result column="db_env" jdbcType="VARCHAR" property="dbEnv"/>
    <result column="db_name" jdbcType="VARCHAR" property="dbName"/>
    <result column="db_column" jdbcType="VARCHAR" property="dbColumn"/>
    <result column="db_sql" jdbcType="VARCHAR" property="dbSql"/>
    <result column="message" jdbcType="VARCHAR" property="message"/>
    <result column="author" jdbcType="VARCHAR" property="author"/>
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
  </resultMap>

  <!--添加参数 -->
  <insert id="addParameter" parameterType="cn.boss.platform.bean.interfaceManager.ParameterBean">
    insert into boss_parameter_tb (project_id, group_id, interface_id, env_id,name,value, type,global, db_env, db_name, db_column, db_sql,message,author,create_time,update_time,case_id)
    values (#{projectId},#{groupId}, #{interfaceId}, #{envId},#{name},#{value},#{type},#{global},#{dbEnv},#{dbName},#{dbColumn},#{dbSql},#{message},#{author},#{createTime},#{updateTime},#{caseId});
  </insert>

  <!--通过参数名查询参数 -->
  <select id="selectByName" parameterType="map" resultMap="BaseResultMap">
    SELECT * from boss_parameter_tb where name = #{name}
  </select>


  <!--通过id查询参数 -->
  <select id="selectParameterByid" parameterType="map" resultMap="BaseResultMap">
    SELECT * from boss_parameter_tb where id = #{id}
  </select>

  <!--分页查询参数 -->
  <select id="getParameter" parameterType="cn.boss.platform.bean.interfaceManager.ParameterBean"
          resultMap="BaseResultMap">
    select * from boss_parameter_tb where 1=1
    <if test="projectId !=null ">
      AND project_id = '${projectId}'
    </if>
    <if test="groupId != null ">
      AND group_id = '${groupId}'
    </if>
    <if test="interfaceId != null ">
      AND interface_id = '${interfaceId}'
    </if>
    <if test="id != null ">
      AND id = '${id}'
    </if>
    <if test="name != null">
      AND name like '%${name}%'
    </if>
    <if test="type != null ">
      AND type = '${type}'
    </if>
    <if test="global != null ">
      AND global = '${global}'
    </if>
    order by create_time DESC limit #{startSize},#{pageSize}
  </select>

  <!--分页查询参数个数 -->
  <select id="getParameterCount" parameterType="cn.boss.platform.bean.interfaceManager.ParameterBean"
          resultType="java.lang.Integer">
    select count(*) from boss_parameter_tb where 1=1
    <if test="projectId !=null ">
      AND project_id = '${projectId}'
    </if>
    <if test="groupId != null ">
      AND group_id = '${groupId}'
    </if>
    <if test="interfaceId != null ">
      AND interface_id = '${interfaceId}'
    </if>
    <if test="id != null ">
      AND id = '${id}'
    </if>
    <if test="name != null">
      AND name like '%${name}%'
    </if>
    <if test="type != null ">
      AND type = '${type}'
    </if>
    <if test="global != null ">
      AND global = '${global}'
    </if>
    order by create_time DESC limit #{startSize},#{pageSize}
  </select>


  <!--删除参数 -->
  <delete id="deleteParameter" parameterType="map">
    DELETE FROM boss_parameter_tb where id = ${id}
  </delete>
  <!--更新参数 -->
  <update id="updateParameter" parameterType="cn.boss.platform.bean.interfaceManager.ParameterBean">
    update boss_parameter_tb
    <set>
      project_id = #{projectId},
      group_id = #{groupId},
      interface_id = #{interfaceId},
      env_id = #{envId},
      name = #{name},
      value = #{value},
      type = #{type},
      global = #{global},
      db_env = #{dbEnv},
      db_name = #{dbName},
      db_column = #{dbColumn},
      db_sql = #{dbSql},
      message = #{message},
      author = #{author},
      update_time = #{updateTime},
      case_id = #{caseId},
    </set>
    where id = #{id}
  </update>


  <select id="isInUse" parameterType="map" resultType="java.lang.Boolean">
    <bind name="pattern" value="'%${' + parameterName + '%}'"></bind>
    SELECT count(1) FROM boss_case_tb where secretKey like #{pattern} OR t like #{pattern} OR pre_processing like #{pattern} OR headers like #{pattern}
    OR public_parameters like #{pattern} OR parameters like #{pattern} OR expected_result like #{pattern} OR post_processing like #{pattern};
  </select>

</mapper>